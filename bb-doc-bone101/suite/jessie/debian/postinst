#!/bin/sh
#
# see: dh_installdeb(1)

set -e

package="bone101"

npm_pkg_install () {
	echo "${package}:installing:[${npm_file}]"
	if [ -d /usr/local/lib/node_modules/${npm_project}/ ] ; then
		rm -rf /usr/local/lib/node_modules/${npm_project}/ || true
	fi

	echo "${package}:updating: /usr/local/lib/node_modules/${npm_project}/"
	tar xf /var/cache/${package}/${npm_file} -C /usr/local/lib/node_modules/
}

npm_install () {
	node_bin="/usr/bin/nodejs"
	npm_bin="/usr/bin/npm"

	unset node_version
	node_version=$(/usr/bin/nodejs --version || true)
	echo "${package}:nodejs:[${node_version}]"

	case "${node_version}" in
	v0.12.*)
		npm_project="${package}"
		npm_file="async-2.0.0-rc.6-v0.12.17.tar.xz"
		npm_pkg_install
		npm_file="sensortag-1.2.3-v0.12.17.tar.xz"
		npm_pkg_install
		;;
	v4.*)
		npm_project="${package}"
		npm_file="async-2.0.0-rc.6-v4.6.2.tar.xz"
		npm_pkg_install
		npm_file="sensortag-1.2.3-v4.6.2.tar.xz"
		npm_pkg_install
		;;
	v6.*)
		npm_project="${package}"
		npm_file="async-2.0.0-rc.6-v6.9.1.tar.xz"
		npm_pkg_install
		npm_file="sensortag-1.2.3-v6.9.1.tar.xz"
		npm_pkg_install
		;;
	esac
}

npm_install

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0

